<head>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
            inlineMath: [['$','$']]
            }
        });
    </script>
</head>

# 一维例子

## 题目

拉格朗日型无网格粒子法在描述结构毁伤行为时具有先天的优势。假定单位长度细长梁结构如下图所示，梁的截面内被离散为单个粒子，在初始状态下梁内变量$\eta(x)=x$，请选用三次样条核函数，光滑长度$h=1.3\Delta{x}$，通过SPH方法中的粒子近似原理编程求解每个粒子处的变量值。

（1）粒子分辨率$\Delta{x}=0.2$和$\Delta{x}=0.1$情况；

参考答案：（1）对于函数的粒子近似存在以下表达形式：

$$<f(x_i)>=\sum_jf(x_j)W(x_i-x_j,h)dV_j$$

三次样条函数为：

$$W(q,h)=\alpha\left\{ \begin{array}{ll}\frac{2}{3}-q^2+\frac{1}{2}q^3 &,0\le q\lt1\\\frac{1}{6}(2-q)^3&,1\le q\lt2\\0&,q\gt2\end{array}\right.$$

其中$\alpha=1/h$，$q=r/h$。

①粒子分辨率为$\Delta x=0.2$情况：

支持域半径为$R=2h=2.6\Delta x$，粒子从左到右编号分别为1~6：

粒子1：与其相互作用的粒子编号：1，2，3

因此$<f(0)>=\sum_{j=1,2,3}f(x_j)W_{ij}\Delta x=0.0516$

粒子2：与其相互作用的粒子编号：1，2，3，4

因此$<f(0.2)>=\sum_{j=1,2,3,4}f(x_j)W_{ij}\Delta x=0.2032$

粒子3：与其相互作用的粒子编号：1，2，3，4，5

因此$<f(0.4)>=\sum_{j=1,2,3,4,5}f(x_j)W_{ij}\Delta x=0.4014$

①粒子分辨率为$\Delta x=0.2$情况：

| 粒子编号 | 1 | 2 | 3 | 4 | 5 | 6 |
| ------  | -- | -- | -- | -- | -- | -- |
| 函数近似值 | 0.0516 | 0.2032 | 0.4014 | 0.6021 | 0.7876 | 0.7066 |
| 函数真值 | 0.0 | 0.2 | 0.4 | 0.6 | 0.8 | 1.0 |
| 相对误差 | - | 1.6% | 0.3% | 0.3% | 1.5% | 29.3% |

## 示例代码

```matlab
% func partcleApproximation 粒子近似值函数. 
function f = particleApproximation(i,tol,h,dx)
    A1 = 1; A2 = 1; A3 = 1; A4 = 1;
    if     i == 1
        A1 = 0; A2 = 0;
    elseif i == 2
        A1 = 0;
    elseif i == tol
        A3 = 0; A4 = 0;
    elseif i == tol-1
        A4 = 0;
    else
        % 此处不执行任何语句.
    end
    f = A1*dx*(i-3)*cubicSpline(2*dx,h)*dx+A2*dx*(i-2)*cubicSpline(dx,h)*dx+dx*(i-1)*cubicSpline(0,h)*dx+A3*dx*i*cubicSpline(-dx,h)*dx+A4*dx*(i+1)*cubicSpline(-2*dx,h)*dx;
end
```

```matlab
% func cubicSpline 是三次样条函数(光滑核函数). 
function w = cubicSpline(r,h)
    r     = abs(r);
    alpha = 1/h;
    q     = r/h;
    if    q>=0 && q<1
        w = alpha*(2/3-q^2+0.5*q^3);
    elseif q>=1 && q<2
        w = alpha*(1/6*(2-q)^3);
    elseif q>=2
        w = 0;
    else
        fprintf("q = %d 是否小于了0; 请检查! ",q);
    end
end
```

```matlab
% SPH(Smoothed Particle Hydrodynamics)法 是光滑粒子流体动力学方法的缩写.
% 描述：
% 一维无网格实例
%
% 方法：
% B样条核函数
% 
% 代码所有者：
% 左志华[zoziha] zuo.zhihua@qq.com
%
% 版本   日期     注释
% ---- -------- -------
% V1.0 2020-6-1 原始版本 左志华
%
% 软件标准：Octave 6.1
%
% float dx 是粒子分辨率; 下语句 并且赋值 dx=0.2. [2020-6-1 wrote; 可修改 dx 值]
dx = 0.2;
% float tol 是粒子总数. [2020-6-1 wrote; 可修改 tol 值]
tol = 6;
% float h 是光滑长度. 
h = 1.3*dx;
% float r 是域半径. 
r = 2*h;
% 下语句 在屏幕打印出 f
for i = 1:tol
    f = particleApproximation(i,tol,h,dx);
    disp(f);
end
```